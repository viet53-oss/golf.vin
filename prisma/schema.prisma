// ============================================================================
// SIMPLIFIED GOLF SCORING DATABASE SCHEMA
// ============================================================================
// This schema contains only the essential fields needed for golf scoring
// Removed unnecessary fields and simplified relationships for better maintainability
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// CORE MODELS
// ============================================================================

// Player - Golf club members and guests
model Player {
  id            String   @id @default(uuid())
  name          String
  email         String?  @unique
  phone         String?
  password      String?
  birthday      String?
  dateStarted   String?
  preferredTeeBox String?
  
  // Handicap Information
  handicapIndex Float    @default(0)

  // Auth
  resetToken          String?  @unique
  resetTokenExpiry    DateTime?
  
  // Relationships
  rounds        RoundPlayer[]
  liveRounds    LiveRoundPlayer[]
  
  createdAt     DateTime @default(now())
  
  @@map("players")
}

// Course - Golf courses
model Course {
  id         String   @id @default(uuid())
  name       String
  
  // Relationships
  holes      Hole[]
  teeBoxes   TeeBox[]
  rounds     Round[]
  liveRounds LiveRound[]
  
  createdAt  DateTime @default(now())
  
  @@map("courses")
}

// TeeBox - Different tee positions on a course
model TeeBox {
  id         String   @id @default(uuid())
  courseId   String
  name       String   // e.g., "Blue", "White", "Red"
  rating     Float    // Course rating
  slope      Int      // Slope rating
  par        Int      // Total par for the course
  
  // Relationships
  course     Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  rounds     RoundPlayer[]
  liveRounds LiveRoundPlayer[]
  
  createdAt  DateTime @default(now())
  
  @@map("tee_boxes")
}

// Hole - Individual holes on a course
model Hole {
  id          String   @id @default(uuid())
  courseId    String
  holeNumber  Int      // 1-18
  par         Int      // Par for this hole
  difficulty  Int?     // Handicap/Stroke Index (1-18)
  name        String?  // e.g., "Hole 1", "The Island Green"
  
  // GPS Coordinates (optional)
  latitude    Float?
  longitude   Float?
  
  // Relationships
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  scores      Score[]
  liveScores  LiveScore[]
  
  @@unique([courseId, holeNumber])
  @@map("holes")
}

// ============================================================================
// REGULAR ROUNDS (Completed/Historical)
// ============================================================================

// Round - A completed round of golf
model Round {
  id            String   @id @default(uuid())
  date          String   // YYYY-MM-DD format
  courseId      String
  courseName    String
  
  // Round Type
  isTournament  Boolean  @default(false)
  name          String?  // Tournament name if applicable
  
  // Relationships
  course        Course   @relation(fields: [courseId], references: [id])
  players       RoundPlayer[]
  
  createdAt     DateTime @default(now())
  
  @@index([date])
  @@map("rounds")
}

// RoundPlayer - Player's participation in a round
model RoundPlayer {
  id              String   @id @default(uuid())
  roundId         String
  playerId        String
  teeBoxId        String
  name            String?  // Player name for easy identification
  
  // Scoring
  grossScore      Int?     // Total strokes
  courseHandicap  Int      // Handicap for this round
  netScore        Int?     // Gross - Handicap
  indexAtTime     Float?   @map("index_at_time")
  points          Float    @default(0)
  payout          Float    @default(0)
  inPool          Boolean  @default(false) @map("in_pool")
  
  // Nine scores (optional)
  frontNine       Int?
  backNine        Int?
  
  // Relationships
  round           Round    @relation(fields: [roundId], references: [id], onDelete: Cascade)
  player          Player   @relation(fields: [playerId], references: [id])
  teeBox          TeeBox   @relation(fields: [teeBoxId], references: [id])
  scores          Score[]
  
  createdAt       DateTime @default(now())
  
  @@index([roundId])
  @@index([playerId])
  @@map("round_players")
}

// Score - Individual hole scores for a round
model Score {
  id              String      @id @default(uuid())
  roundPlayerId   String
  holeId          String
  strokes         Int
  name            String?     // e.g., "Player Name - Hole 1"
  
  // Additional stats (optional)
  putts           Int?
  fairwayHit      Boolean?
  greenInReg      Boolean?    // Green in regulation
  
  // Relationships
  roundPlayer     RoundPlayer @relation(fields: [roundPlayerId], references: [id], onDelete: Cascade)
  hole            Hole        @relation(fields: [holeId], references: [id])
  
  @@unique([roundPlayerId, holeId])
  @@map("scores")
}

// ============================================================================
// LIVE ROUNDS (In-Progress)
// ============================================================================

// LiveRound - A round currently being played
model LiveRound {
  id          String   @id @default(uuid())
  name        String
  date        String   // YYYY-MM-DD format
  courseId    String
  courseName  String
  
  // Relationships
  course      Course   @relation(fields: [courseId], references: [id])
  players     LiveRoundPlayer[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([date])
  @@map("live_rounds")
}

// LiveRoundPlayer - Player's participation in a live round
model LiveRoundPlayer {
  id              String   @id @default(uuid())
  liveRoundId     String
  playerId        String?  // Null for guest players
  teeBoxId        String
  
  // Snapshot Data
  indexAtTime     Float    @default(0) @map("index_at_time")
  scorerId        String?  @map("scorer_id")
  teeBoxName      String?  @map("tee_box_name")

  // Guest Player Info
  isGuest         Boolean  @default(false)
  guestName       String?
  
  // Scoring Info
  courseHandicap  Int
  grossScore      Int?
  frontNine       Int?
  backNine        Int?
  
  // Relationships
  liveRound       LiveRound @relation(fields: [liveRoundId], references: [id], onDelete: Cascade)
  player          Player?   @relation(fields: [playerId], references: [id])
  teeBox          TeeBox    @relation(fields: [teeBoxId], references: [id])
  scores          LiveScore[]
  
  @@index([liveRoundId])
  @@map("live_round_players")
}

// LiveScore - Individual hole scores for a live round
model LiveScore {
  id                  String          @id @default(uuid())
  liveRoundPlayerId   String
  holeId              String
  strokes             Int
  
  // Relationships
  liveRoundPlayer     LiveRoundPlayer @relation(fields: [liveRoundPlayerId], references: [id], onDelete: Cascade)
  hole                Hole            @relation(fields: [holeId], references: [id])
  
  @@unique([liveRoundPlayerId, holeId])
  @@map("live_scores")
}

// ============================================================================
// SUPPORTING MODELS
// ============================================================================

// Photo - Gallery photos
model Photo {
  id          String   @id @default(uuid())
  url         String
  date        String   // YYYY-MM-DD format
  caption     String?
  
  uploadedAt  DateTime @default(now())
  
  @@map("photos")
}

// Event - Scheduled events
model Event {
  id         String   @id @default(uuid())
  name       String
  date       String   // YYYY-MM-DD format
  location   String?
  
  createdAt  DateTime @default(now())
  
  @@map("events")
}
